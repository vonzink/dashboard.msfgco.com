<!doctype html>
<html lang="en">
<head>
  <!-- AUTH GATE (must be first script in head) -->
  <script src="js/auth-gate.js?v=20260224-2"></script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MSFG Dashboard | Mountain State Financial Group</title>

  <!-- CloudFront owns CSP + other security headers now.
       Do NOT put CSP meta in HTML (frame-ancestors is ignored in meta CSP). -->

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet" />

  <!-- Icons -->
  <link rel="stylesheet" href="/vendor/fontawesome/css/all.min.css" />

  <!-- Styles -->
  <link rel="stylesheet" href="css/variables.css?v=20260224-2" />
  <link rel="stylesheet" href="css/base.css?v=20260224-2" />
  <link rel="stylesheet" href="css/layout.css?v=20260224-2" />
  <link rel="stylesheet" href="css/components.css?v=20260224-2" />
  <link rel="stylesheet" href="css/tables.css?v=20260224-2" />
  <link rel="stylesheet" href="css/sections.css?v=20260224-2" />
  <link rel="stylesheet" href="css/chat.css?v=20260224-2" />
  <link rel="stylesheet" href="css/animations.css?v=20260224-2" />
</head>

<body>
  <!-- Skip link for keyboard users -->
  <a href="#mainContent" class="skip-link">Skip to content</a>

  <header class="header">
    <div class="header-top">
      <div class="logo-container">
        <img
          src="https://msfg-media.s3.us-west-2.amazonaws.com/Assets/LOGOS/MSFG+Home+Loans/MSFG+Clear+backdrop.png"
          alt="MSFG Logo"
          class="logo"
        />
      </div>

      <div class="header-right">
        <!-- Utility Toolbar -->
        <div class="header-utils">
          <a data-link-key="ratesheet" class="header-util-btn" title="Today's Rate Sheet">
            <i class="fas fa-chart-bar"></i>
          </a>
          <button type="button" class="header-util-btn" data-action="open-lock-desk" title="Lock Desk">
            <i class="fas fa-file-alt"></i>
          </button>
          <button type="button" class="header-util-btn" data-action="open-support-ticket" title="Support Ticket">
            <i class="fas fa-headset"></i>
          </button>
          <button type="button" class="header-util-btn" data-action="open-notifications" title="Notifications">
            <i class="fas fa-bell"></i>
          </button>
          <button type="button" class="header-util-btn" data-action="open-settings" title="Settings">
            <i class="fas fa-cog"></i>
          </button>
          <button type="button" class="header-util-btn admin-only-item" data-action="open-admin-settings" title="Admin Settings" style="display:none;">
            <i class="fas fa-user-shield"></i>
          </button>
        </div>

        <div class="header-divider"></div>

        <div class="user-info">
          <div class="user-avatar" id="userAvatar">ZB</div>
          <div>
            <div class="user-name" id="userName">Zachary</div>
            <div class="user-role" id="userRole">Loan Officer</div>
          </div>
        </div>

        <button type="button" class="theme-toggle" id="themeToggle" title="Toggle Dark Mode">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </div>

    <!-- Navigation -->
    <nav class="nav-container" aria-label="Primary">
      <ul class="main-nav">

        <!-- HR -->
        <li class="nav-item">
          <button type="button" class="nav-button">
            <i class="fas fa-users"></i>
            HR
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="dropdown-menu">
            <div class="dropdown-header">Human Resources</div>

            <a data-link-key="payroll_new" class="dropdown-item">
              <i class="fas fa-file-invoice-dollar"></i> View Paycheck
            </a>

            <button type="button" class="dropdown-item" data-action="open-401k">
              <i class="fas fa-piggy-bank"></i> 401K
            </button>
            <button type="button" class="dropdown-item" data-action="open-handbook">
              <i class="fas fa-book"></i> Handbook
            </button>
            <div class="dropdown-divider"></div>
            <button type="button" class="dropdown-item" data-action="open-training">
              <i class="fas fa-graduation-cap"></i> Training
            </button>
          </div>
        </li>

        <!-- MSFG Contacts -->
        <li class="nav-item">
          <button type="button" class="nav-button">
            <i class="fas fa-address-book"></i>
            MSFG Contacts
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="dropdown-menu dropdown-menu-contacts">
            <div class="dropdown-header">Team Directory</div>
            <div id="contactsEmployeeList">
              <span class="text-muted" style="padding: 0.5rem 1rem; font-size: 0.8rem;">Loading...</span>
            </div>
          </div>
        </li>

        <!-- Systems -->
        <li class="nav-item">
          <button type="button" class="nav-button">
            <i class="fas fa-laptop-code"></i>
            Systems
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="dropdown-menu">
            <div class="dropdown-header">Core Systems</div>

            <a data-link-key="gohighlevel" class="dropdown-item"><i class="fas fa-rocket"></i> Go High Level</a>
            <a data-link-key="lendingpad" class="dropdown-item"><i class="fas fa-file-contract"></i> LendingPad</a>
            <a data-link-key="monday" class="dropdown-item"><i class="fas fa-columns"></i> Monday.com</a>

            <div class="dropdown-divider"></div>
            <div class="dropdown-header">Tools & Services</div>

            <a data-link-key="mmi" class="dropdown-item"><i class="fas fa-chart-line"></i> MMI</a>
            <a data-link-key="loan_sifter" class="dropdown-item"><i class="fas fa-search-dollar"></i> Loan Sifter</a>
            <a data-link-key="listreports" class="dropdown-item"><i class="fas fa-list-alt"></i> List Reports</a>
            <a data-link-key="passport" class="dropdown-item"><i class="fas fa-passport"></i> Passport</a>
            <a data-link-key="flueid" class="dropdown-item"><i class="fas fa-water"></i> Flueid</a>

            <div class="dropdown-divider"></div>
            <div class="dropdown-header">Storage & Credit</div>

            <a data-link-key="dropbox" class="dropdown-item"><i class="fab fa-dropbox"></i> Dropbox</a>
            <a data-link-key="advantage_credit" class="dropdown-item"><i class="fas fa-credit-card"></i> Advantage Credit</a>
            <a data-link-key="microsoft" class="dropdown-item"><i class="fab fa-microsoft"></i> Microsoft</a>
          </div>
        </li>

        <!-- Schedule -->
        <li class="nav-item">
          <button type="button" class="nav-button">
            <i class="fas fa-calendar-alt"></i>
            Schedule
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="dropdown-menu">
            <div class="dropdown-header">Scheduling</div>
            <button type="button" class="dropdown-item" data-action="open-company-calendar"><i class="fas fa-calendar"></i> Company Calendar</button>
            <a data-link-key="teams" class="dropdown-item"><i class="fas fa-video"></i> Meeting Rooms (Teams)</a>
          </div>
        </li>

        <!-- Marketing -->
        <li class="nav-item">
          <button type="button" class="nav-button">
            <i class="fas fa-bullhorn"></i>
            Marketing
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="dropdown-menu">
            <div class="dropdown-header">Brand Assets</div>
            <button type="button" class="dropdown-item" data-action="open-logos-browser"><i class="fas fa-image"></i> Logos</button>
            <button type="button" class="dropdown-item" data-action="open-brand-guidelines"><i class="fas fa-palette"></i> Brand Guidelines</button>

            <div class="dropdown-divider"></div>
            <div class="dropdown-header">Content Engine</div>
            <a data-link-key="keyword_explorer" class="dropdown-item"><i class="fas fa-search"></i> Keyword Explorer</a>

            <div class="dropdown-divider"></div>
            <div class="dropdown-header">Social</div>
            <a data-link-key="facebook" class="dropdown-item"><i class="fab fa-facebook"></i> Facebook</a>
            <a data-link-key="instagram" class="dropdown-item"><i class="fab fa-instagram"></i> Instagram</a>
            <a data-link-key="youtube" class="dropdown-item"><i class="fab fa-youtube"></i> YouTube</a>
            <a data-link-key="linkedin" class="dropdown-item"><i class="fab fa-linkedin"></i> LinkedIn</a>
          </div>
        </li>

        <!-- Programs -->
        <li class="nav-item">
          <button type="button" class="nav-button">
            <i class="fas fa-th-large"></i>
            Programs
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="dropdown-menu">
            <div class="dropdown-header">Loan Programs</div>
            <button type="button" class="dropdown-item" data-action="open-program-conventional"><i class="fas fa-home"></i> Conventional</button>
            <button type="button" class="dropdown-item" data-action="open-program-fha"><i class="fas fa-flag-usa"></i> FHA</button>
            <button type="button" class="dropdown-item" data-action="open-program-va"><i class="fas fa-medal"></i> VA</button>
            <button type="button" class="dropdown-item" data-action="open-program-usda"><i class="fas fa-tractor"></i> USDA</button>
            <button type="button" class="dropdown-item" data-action="open-program-jumbo"><i class="fas fa-building"></i> Jumbo</button>
            <button type="button" class="dropdown-item" data-action="open-program-refi"><i class="fas fa-sync-alt"></i> Refinance</button>
          </div>
        </li>

        <!-- Investors -->
        <li class="nav-item">
          <button type="button" class="nav-button">
            <i class="fas fa-handshake"></i>
            Investors
            <i class="fas fa-chevron-down"></i>
          </button>

          <div class="dropdown-menu dropdown-menu-investors">
            <div id="investorDropdownList">
              <div class="dropdown-header">Wholesale Partners</div>
              <span class="text-muted" style="padding: 0.5rem 1rem; font-size: 0.8rem;">Loading...</span>
            </div>

            <div class="dropdown-divider"></div>
            <button type="button" class="dropdown-item admin-only-item" data-action="manage-investors" style="display:none;">
              <i class="fas fa-cog"></i> Manage Investors
            </button>
          </div>
        </li>

        <!-- Tools -->
        <li class="nav-item">
          <button type="button" class="nav-button">
            <i class="fas fa-tools"></i>
            Tools
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="dropdown-menu">
            <div class="dropdown-header">Calculators</div>
            <a data-link-key="loan_calc_hub" class="dropdown-item"><i class="fas fa-calculator"></i> Loan Calculator Hub</a>

            <div class="dropdown-divider"></div>
            <div class="dropdown-header">Resources</div>
            <button type="button" class="dropdown-item" data-action="open-guidelines"><i class="fas fa-book-open"></i> Guidelines</button>
            <button type="button" class="dropdown-item" data-action="open-checklists"><i class="fas fa-tasks"></i> Checklists</button>
            <button type="button" class="dropdown-item" data-action="open-forms-library"><i class="fas fa-file-pdf"></i> Forms Library</button>
          </div>
        </li>

      </ul>
    </nav>
  </header>

  <main class="main-content" id="mainContent" tabindex="-1">

    <!-- News + Quick Links -->
    <section class="section-card animate-in">
      <div class="section-header">
        <h2 class="section-title"><i class="fas fa-newspaper"></i> Daily News & Announcements</h2>
        <div class="section-actions">
          <button type="button" class="btn btn-secondary" data-action="open-add-announcement">
            <i class="fas fa-plus"></i> Add Announcement
          </button>
        </div>
      </div>

      <div class="section-body">
        <div class="news-feed" id="newsFeed"></div>
      </div>
    </section>

    <!-- Pre-Approvals (Monday.com Sync) -->
    <section class="section-card animate-in" id="preApprovalsSection">
      <div class="section-header">
        <h2 class="section-title"><i class="fas fa-clipboard-check"></i> Pre-Approvals</h2>
        <div class="section-actions">
          <input type="text" id="preApprovalSearch" class="search-input" placeholder="Search pre-approvals..." />
          <button type="button" class="btn btn-secondary btn-sm monday-sync-btn" data-action="monday-sync" title="Sync from Monday.com">
            <i class="fas fa-sync-alt"></i> Sync
          </button>
        </div>
      </div>

      <div class="section-body">
        <div class="table-responsive">
          <table class="data-table" id="preApprovalsTable">
            <thead>
              <tr>
                <th class="sortable">Client Name</th>
                <th class="sortable text-right">Loan Amount</th>
                <th class="sortable">Pre-Approval Date</th>
                <th class="sortable">Expiration Date</th>
                <th class="sortable">Status</th>
                <th class="sortable">Loan Officer</th>
                <th>Property Address</th>
                <th class="sortable">Loan Type</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody id="preApprovalsBody">
              <tr><td colspan="9" class="empty-state">
                <i class="fas fa-database"></i>
                <p>No pre-approval data yet. Sync from Monday.com to populate.</p>
              </td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Pipeline (Monday.com Sync) -->
    <section class="section-card animate-in" id="pipelineSection">
      <div class="section-header">
        <h2 class="section-title"><i class="fas fa-chart-line"></i> Loan Pipeline</h2>
        <div class="section-actions">
          <input type="text" id="pipelineSearch" class="search-input" placeholder="Search pipeline..." />
          <select class="filter-select" id="pipelineLO">
            <option value="">All Loan Officers</option>
          </select>
          <button type="button" class="btn btn-secondary btn-sm monday-sync-btn" id="mondaySyncBtn" data-action="monday-sync" title="Sync from Monday.com">
            <i class="fas fa-sync-alt"></i> Sync
          </button>
        </div>
      </div>

      <div class="section-body">
        <div class="sync-status-bar" id="syncStatusBar" style="display:none;">
          <i class="fas fa-info-circle"></i>
          <span id="syncStatusText">Last synced: Never</span>
        </div>

        <div class="table-responsive">
          <table class="data-table" id="pipelineTable">
            <thead id="pipelineHead">
              <tr><th colspan="12"><i class="fas fa-spinner fa-spin"></i> Loading pipeline...</th></tr>
            </thead>
            <tbody id="pipelineBody">
              <tr><td class="empty-state">
                <i class="fas fa-database"></i>
                <p>No pipeline data yet. Sync from Monday.com to populate.</p>
              </td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Loans Funded -->
    <section class="section-card animate-in" id="fundedLoansSection">
      <div class="section-header">
        <h2 class="section-title"><i class="fas fa-hand-holding-usd"></i> Loans Funded</h2>
        <div class="section-actions">
          <select class="filter-select" id="fundedGroupSelect" style="display:none;">
            <option value="">All Groups</option>
          </select>
          <select class="filter-select" id="fundedLOSelect" style="display:none;">
            <option value="">All Loan Officers</option>
          </select>
          <select class="filter-select" id="fundedPeriodSelect">
            <option value="ytd" selected>Year to Date</option>
            <option value="mtd">Month to Date</option>
          </select>
          <button type="button" class="btn btn-secondary btn-sm monday-sync-btn" data-action="monday-sync" title="Sync from Monday.com">
            <i class="fas fa-sync-alt"></i> Sync
          </button>
        </div>
      </div>

      <div class="section-body">
        <!-- Summary bar -->
        <div class="funded-summary-bar" id="fundedSummaryBar">
          <div class="funded-stat">
            <span class="funded-stat-label">Total Units</span>
            <span class="funded-stat-value" id="fundedTotalUnits">0</span>
          </div>
          <div class="funded-stat">
            <span class="funded-stat-label">Total Volume</span>
            <span class="funded-stat-value" id="fundedTotalAmount">$0</span>
          </div>
        </div>

        <div class="table-responsive">
          <table class="data-table" id="fundedLoansTable">
            <thead>
              <tr>
                <th>Borrower</th>
                <th class="text-right">Loan Amount</th>
                <th>Loan Officer</th>
                <th>Group</th>
                <th>Product</th>
                <th>Funded Date</th>
              </tr>
            </thead>
            <tbody id="fundedLoansBody">
              <tr><td colspan="6" class="empty-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading funded loans...</p>
              </td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Performance & Goals -->
    <section class="section-card animate-in">
      <div class="section-header">
        <h2 class="section-title"><i class="fas fa-trophy"></i> Performance & Goals</h2>
        <div class="section-actions">
          <select class="filter-select goal-period-select" id="goalPeriodSelect">
            <option value="weekly">Weekly</option>
            <option value="monthly" selected>Monthly</option>
            <option value="quarterly">Quarterly</option>
            <option value="yearly">Yearly</option>
          </select>
        </div>
      </div>

      <div class="section-body">
        <div class="goals-grid" id="goalsGrid">
          <div class="goal-card" data-goal="loans-closed">
            <div class="goal-icon"><i class="fas fa-file-signature"></i></div>
            <div class="goal-label">Loans Closed</div>
            <div class="goal-value-container">
              <div class="goal-value" id="loansClosedValue">0</div>
              <button type="button" class="goal-edit-btn" title="Edit goal" data-goal="loans-closed"><i class="fas fa-edit"></i></button>
            </div>
            <div class="goal-target">of <span class="goal-target-value" id="loansClosedTarget">0</span> target</div>
            <div class="goal-slider-container u-hidden">
              <input type="range" class="goal-slider" id="loansClosedSlider" min="0" max="100" value="0" step="1" />
              <div class="slider-value-display"><span class="slider-value">0</span></div>
            </div>
            <div class="progress-bar"><div class="progress-fill on-track" id="loansClosedProgress" data-progress="0"></div></div>
            <div class="goal-progress-text" id="loansClosedProgressText">0% complete</div>
          </div>

          <div class="goal-card" data-goal="pull-through">
            <div class="goal-icon"><i class="fas fa-percentage"></i></div>
            <div class="goal-label">Pull-Through</div>
            <div class="goal-value-container">
              <div class="goal-value" id="pullThroughValue">0%</div>
              <button type="button" class="goal-edit-btn" title="Edit goal" data-goal="pull-through"><i class="fas fa-edit"></i></button>
            </div>
            <div class="goal-target">of <span class="goal-target-value" id="pullThroughTarget">0</span>% target</div>
            <div class="goal-slider-container u-hidden">
              <input type="range" class="goal-slider" id="pullThroughSlider" min="0" max="100" value="0" step="1" />
              <div class="slider-value-display"><span class="slider-value">0</span>%</div>
            </div>
            <div class="progress-bar"><div class="progress-fill on-track" id="pullThroughProgress" data-progress="0"></div></div>
            <div class="goal-progress-text" id="pullThroughProgressText">0% complete</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Chat -->
    <section class="section-card animate-in" id="chatSection">
      <div class="section-header">
        <h2 class="section-title"><i class="fas fa-comments"></i> Team Chat</h2>
        <div class="section-actions">
          <button type="button" class="btn btn-sm btn-outline" id="chatManageTagsBtn" title="Manage Tags">
            <i class="fas fa-tags"></i> Manage Tags
          </button>
        </div>
      </div>
      <div class="section-body">
        <div class="chat-container">
          <!-- Tag filter bar -->
          <div class="chat-tag-filter-bar" id="chatTagFilter"></div>

          <!-- Messages -->
          <div class="chat-messages" id="chatMessages" aria-live="polite"></div>

          <!-- Tag picker for outgoing messages -->
          <div class="chat-tag-picker-bar">
            <span class="chat-tag-picker-label"><i class="fas fa-tags"></i> Attach tags:</span>
            <div class="chat-tag-picker" id="chatTagPicker"></div>
          </div>

          <!-- Input -->
          <form class="chat-input-row" id="chatForm">
            <input type="text" id="chatInput" class="chat-input" placeholder="Type a message..." maxlength="1000" autocomplete="off" />
            <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Send</button>
          </form>
        </div>
      </div>
    </section>

    <!-- =========================
         MODALS
    ========================== -->

    <!-- Investor Modal (required by investors.js) -->
    <div id="investorModal" class="investor-modal" aria-hidden="true">
      <div class="modal-content">
        <button type="button" class="modal-close" aria-label="Close modal"><i class="fas fa-times"></i></button>

        <div class="modal-header">
          <div class="investor-header-content">
            <img class="investor-logo" alt="Investor Logo" />
            <h2 class="investor-name">Investor</h2>
          </div>
        </div>

        <div class="modal-body">
          <div class="investor-info-grid">
            <div class="info-section account-executive"></div>
            <div class="info-section investor-details"></div>
            <div class="info-section investor-team"></div>
            <div class="info-section lender-ids"></div>
            <div class="info-section mortgagee-clause"></div>
            <div class="info-section investor-links"></div>

            <div class="info-section investor-notes u-grid-span-all">
              <h4><i class="fas fa-note-sticky"></i> Notes</h4>
              <div class="notes-content empty" contenteditable="true"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Contact Card Modal (populated dynamically by Investors.showContactCard) -->
    <div id="companyContactsModal" class="investor-modal" aria-hidden="true">
      <div class="modal-content" style="max-width:480px;">
        <button type="button" class="contacts-modal-close" aria-label="Close modal">&times;</button>
      </div>
    </div>

    <!-- Support Ticket Modal -->
    <div id="supportTicketModal" class="investor-modal" aria-hidden="true">
      <div class="modal-content">
        <button type="button" class="modal-close support-modal-close" aria-label="Close modal"><i class="fas fa-times"></i></button>
        <div class="modal-header">
          <div class="investor-header-content">
            <h2 class="investor-name">Support Contact</h2>
          </div>
        </div>
        <div class="modal-body">
          <div class="investor-info-grid">
            <div class="info-section u-grid-span-all">
              <h4><i class="fas fa-user-circle"></i> Contact Information</h4>
              <div class="contact-info">
                <div><strong>Zachary Zink</strong></div>
                <div><i class="fas fa-envelope"></i> <a href="mailto:zachary.zink@msfg.us">zachary.zink@msfg.us</a></div>
                <div><i class="fas fa-phone"></i> <a href="tel:3038706518">(303) 870-6518</a></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notificationsModal" class="investor-modal" aria-hidden="true">
      <div class="modal-content">
        <button type="button" class="modal-close notifications-modal-close" aria-label="Close modal"><i class="fas fa-times"></i></button>
        <div class="modal-header">
          <div class="investor-header-content">
            <h2 class="investor-name">Notifications</h2>
          </div>
        </div>
        <div class="modal-body">
          <form id="notificationForm" class="form">
            <div class="form-row">
              <label for="notificationDate">Date</label>
              <input type="date" id="notificationDate" required />
            </div>
            <div class="form-row">
              <label for="notificationTime">Time</label>
              <input type="time" id="notificationTime" required />
            </div>
            <div class="form-row">
              <label for="notificationNote">Note</label>
              <textarea id="notificationNote" rows="3" maxlength="1000" required></textarea>
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary notifications-modal-close">Cancel</button>
              <button type="submit" class="btn btn-primary">Save Reminder</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Add Announcement Modal -->
    <div id="addAnnouncementModal" class="investor-modal" aria-hidden="true">
      <div class="modal-content">
        <button type="button" class="modal-close announcement-modal-close" aria-label="Close modal"><i class="fas fa-times"></i></button>
        <div class="modal-header">
          <div class="investor-header-content">
            <h2 class="investor-name">Add Announcement</h2>
          </div>
        </div>
        <div class="modal-body">
          <form id="announcementForm" class="form">
            <div class="form-row">
              <label for="announcementTitle">Title</label>
              <input type="text" id="announcementTitle" maxlength="120" required />
            </div>
            <div class="form-row">
              <label for="announcementContent">Content</label>
              <textarea id="announcementContent" rows="4" maxlength="2000" required></textarea>
            </div>
            <div class="form-row">
              <label for="announcementLink">Optional Link</label>
              <input type="url" id="announcementLink" placeholder="https://..." />
            </div>
            <div class="form-row">
              <label for="announcementIcon">Icon</label>
              <select id="announcementIcon">
                <option value="fa-bullhorn" selected>Announcement</option>
                <option value="fa-star">Star</option>
                <option value="fa-triangle-exclamation">Alert</option>
                <option value="fa-circle-info">Info</option>
                <option value="fa-graduation-cap">Training</option>
                <option value="fa-handshake">Partner</option>
              </select>
            </div>
            <div class="form-row">
              <label for="announcementFile">Optional File</label>
              <div class="file-input-wrapper">
                <input type="file" id="announcementFile" />
                <span class="file-input-label">Choose file or drag and drop</span>
              </div>
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary announcement-modal-close">Cancel</button>
              <button type="submit" class="btn btn-primary">Publish</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Manage Investors Modal (admin only) -->
    <!-- Manage Tags Modal -->
    <div id="manageTagsModal" class="investor-modal" aria-hidden="true">
      <div class="modal-content" style="max-width: 520px;">
        <div class="modal-header">
          <h3 class="modal-title"><i class="fas fa-tags"></i> Manage Tags</h3>
          <button type="button" class="modal-close" id="closeManageTagsModal" aria-label="Close modal">&times;</button>
        </div>
        <div class="modal-body" style="padding: var(--spacing-md);">
          <!-- Create new tag -->
          <div class="manage-tags-create">
            <div class="manage-tags-create-row">
              <input type="text" id="newTagNameInput" class="form-input" placeholder="New tag name..." maxlength="100" />
              <input type="color" id="newTagColorInput" class="form-input manage-tags-color-input" value="#8cc63e" title="Pick a color" />
              <button type="button" class="btn btn-primary btn-sm" id="createTagSaveBtn"><i class="fas fa-plus"></i> Add</button>
            </div>
          </div>

          <!-- Existing tags list -->
          <div class="manage-tags-list" id="manageTagsList">
            <p class="text-muted" style="text-align:center; padding: 2rem 0;">Loading tags...</p>
          </div>
        </div>
      </div>
    </div>

  </main>

  <footer class="footer">
    <p>
      Â© 2025 Mountain State Financial Group. All rights reserved. |
      <button type="button" class="link-item" data-action="open-privacy">Privacy Policy</button> |
      <button type="button" class="link-item" data-action="open-terms">Terms of Service</button> |
      <button type="button" class="link-item" data-action="open-support">Support</button>
    </p>
  </footer>

  <!-- Scripts (load order matters) -->
  <script src="js/config.js?v=20260224-2"></script>
  <script src="js/link-init.js?v=20260224-2"></script>
  <script src="js/action-dispatcher.js?v=20260224-2"></script>

  <script src="js/api-server.js?v=20260224-2"></script>
  <script src="js/utils.js?v=20260224-2"></script>
  <script src="js/theme.js?v=20260224-2"></script>
  <script src="js/tables.js?v=20260224-2"></script>
  <script src="js/chat.js?v=20260224-2"></script>
  <script src="js/api.js?v=20260224-2"></script>
  <script src="js/investors.js?v=20260224-2"></script>
  <script src="js/funded-loans.js?v=20260224-2"></script>
  <script src="js/goals.js?v=20260224-2"></script>
  <script src="js/modals.js?v=20260224-2"></script>

  <!-- Accessibility -->
  <script src="js/a11y.js?v=20260224-2"></script>

  <!-- CSP-friendly progress widths -->
  <script src="js/progress-init.js?v=20260211-1"></script>

  <script src="js/app.js?v=20260211-1"></script>
</body>
</html>