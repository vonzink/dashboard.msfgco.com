<!doctype html>
<html lang="en">
<head>
  <!-- AUTH GATE (must be first script in head) -->
  <script src="js/auth-gate.js?v=20260211-1"></script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MSFG Dashboard | Mountain State Financial Group</title>

  <!-- CloudFront owns CSP + other security headers now.
       Do NOT put CSP meta in HTML (frame-ancestors is ignored in meta CSP). -->

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet" />

  <!-- Icons -->
  <link rel="stylesheet" href="/vendor/fontawesome/css/all.min.css" />

  <!-- Styles -->
  <link rel="stylesheet" href="css/variables.css" />
  <link rel="stylesheet" href="css/base.css" />
  <link rel="stylesheet" href="css/layout.css" />
  <link rel="stylesheet" href="css/components.css" />
  <link rel="stylesheet" href="css/tables.css?v=20260211-1" />
  <link rel="stylesheet" href="css/sections.css" />
  <link rel="stylesheet" href="css/chat.css" />
  <link rel="stylesheet" href="css/animations.css" />
</head>

<body>
  <!-- Skip link for keyboard users -->
  <a href="#mainContent" class="skip-link">Skip to content</a>

  <header class="header">
    <div class="header-top">
      <div class="logo-container">
        <img
          src="https://msfg-media.s3.us-west-2.amazonaws.com/Assets/LOGOS/MSFG+Home+Loans/MSFG+Clear+backdrop.png"
          alt="MSFG Logo"
          class="logo"
        />
      </div>

      <div class="header-right">
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">ZB</div>
          <div>
            <div class="user-name" id="userName">Zachary</div>
            <div class="user-role" id="userRole">Loan Officer</div>
          </div>
        </div>

        <button type="button" class="theme-toggle" id="themeToggle" title="Toggle Dark Mode">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </div>

    <!-- Navigation -->
    <nav class="nav-container" aria-label="Primary">
      <ul class="main-nav">

        <!-- HR -->
        <li class="nav-item">
          <button type="button" class="nav-button">
            <i class="fas fa-users"></i>
            HR
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="dropdown-menu">
            <div class="dropdown-header">Human Resources</div>

            <a data-link-key="payroll_new" class="dropdown-item">
              <i class="fas fa-file-invoice-dollar"></i> View Paycheck
            </a>

            <button type="button" class="dropdown-item" data-action="open-401k">
              <i class="fas fa-piggy-bank"></i> 401K
            </button>
            <button type="button" class="dropdown-item" data-action="open-handbook">
              <i class="fas fa-book"></i> Handbook
            </button>
            <button type="button" class="dropdown-item" data-action="open-company-contacts">
              <i class="fas fa-address-book"></i> Contacts
            </button>
            <button type="button" class="dropdown-item" data-action="open-training">
              <i class="fas fa-graduation-cap"></i> Training
            </button>
          </div>
        </li>

        <!-- Systems -->
        <li class="nav-item">
          <button type="button" class="nav-button">
            <i class="fas fa-laptop-code"></i>
            Systems
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="dropdown-menu">
            <div class="dropdown-header">Core Systems</div>

            <a data-link-key="gohighlevel" class="dropdown-item"><i class="fas fa-rocket"></i> Go High Level</a>
            <a data-link-key="lendingpad" class="dropdown-item"><i class="fas fa-file-contract"></i> LendingPad</a>
            <a data-link-key="monday" class="dropdown-item"><i class="fas fa-columns"></i> Monday.com</a>

            <div class="dropdown-divider"></div>
            <div class="dropdown-header">Tools & Services</div>

            <a data-link-key="mmi" class="dropdown-item"><i class="fas fa-chart-line"></i> MMI</a>
            <a data-link-key="loan_sifter" class="dropdown-item"><i class="fas fa-search-dollar"></i> Loan Sifter</a>
            <a data-link-key="listreports" class="dropdown-item"><i class="fas fa-list-alt"></i> List Reports</a>
            <button type="button" class="dropdown-item" data-action="open-valuecheck"><i class="fas fa-check-circle"></i> ValueCheck</button>
            <a data-link-key="passport" class="dropdown-item"><i class="fas fa-passport"></i> Passport</a>
            <a data-link-key="flueid" class="dropdown-item"><i class="fas fa-water"></i> Flueid</a>

            <div class="dropdown-divider"></div>
            <div class="dropdown-header">Storage & Credit</div>

            <a data-link-key="dropbox" class="dropdown-item"><i class="fab fa-dropbox"></i> Dropbox</a>
            <a data-link-key="advantage_credit" class="dropdown-item"><i class="fas fa-credit-card"></i> Advantage Credit</a>
            <a data-link-key="microsoft" class="dropdown-item"><i class="fab fa-microsoft"></i> Microsoft</a>
          </div>
        </li>

        <!-- Schedule -->
        <li class="nav-item">
          <button type="button" class="nav-button">
            <i class="fas fa-calendar-alt"></i>
            Schedule
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="dropdown-menu">
            <div class="dropdown-header">Scheduling</div>
            <button type="button" class="dropdown-item" data-action="open-company-calendar"><i class="fas fa-calendar"></i> Company Calendar</button>
            <button type="button" class="dropdown-item" data-action="open-timeoff-requests"><i class="fas fa-clock"></i> Time Off Requests</button>
            <a data-link-key="teams" class="dropdown-item"><i class="fas fa-video"></i> Meeting Rooms (Teams)</a>
          </div>
        </li>

        <!-- Marketing -->
        <li class="nav-item">
          <button type="button" class="nav-button">
            <i class="fas fa-bullhorn"></i>
            Marketing
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="dropdown-menu">
            <div class="dropdown-header">Brand Assets</div>
            <button type="button" class="dropdown-item" data-action="open-logos-browser"><i class="fas fa-image"></i> Logos</button>
            <button type="button" class="dropdown-item" data-action="open-brand-guidelines"><i class="fas fa-palette"></i> Brand Guidelines</button>

            <div class="dropdown-divider"></div>
            <div class="dropdown-header">Content Engine</div>
            <a data-link-key="keyword_explorer" class="dropdown-item"><i class="fas fa-search"></i> Keyword Explorer</a>

            <div class="dropdown-divider"></div>
            <div class="dropdown-header">Social</div>
            <a data-link-key="facebook" class="dropdown-item"><i class="fab fa-facebook"></i> Facebook</a>
            <a data-link-key="instagram" class="dropdown-item"><i class="fab fa-instagram"></i> Instagram</a>
            <a data-link-key="youtube" class="dropdown-item"><i class="fab fa-youtube"></i> YouTube</a>
            <button type="button" class="dropdown-item" data-action="open-linkedin"><i class="fab fa-linkedin"></i> LinkedIn</button>
          </div>
        </li>

        <!-- Programs -->
        <li class="nav-item">
          <button type="button" class="nav-button">
            <i class="fas fa-th-large"></i>
            Programs
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="dropdown-menu">
            <div class="dropdown-header">Loan Programs</div>
            <button type="button" class="dropdown-item" data-action="open-program-conventional"><i class="fas fa-home"></i> Conventional</button>
            <button type="button" class="dropdown-item" data-action="open-program-fha"><i class="fas fa-flag-usa"></i> FHA</button>
            <button type="button" class="dropdown-item" data-action="open-program-va"><i class="fas fa-medal"></i> VA</button>
            <button type="button" class="dropdown-item" data-action="open-program-usda"><i class="fas fa-tractor"></i> USDA</button>
            <button type="button" class="dropdown-item" data-action="open-program-jumbo"><i class="fas fa-building"></i> Jumbo</button>
            <button type="button" class="dropdown-item" data-action="open-program-refi"><i class="fas fa-sync-alt"></i> Refinance</button>
          </div>
        </li>

        <!-- Investors -->
        <li class="nav-item">
          <button type="button" class="nav-button">
            <i class="fas fa-handshake"></i>
            Investors
            <i class="fas fa-chevron-down"></i>
          </button>

          <div class="dropdown-menu dropdown-menu-investors">
            <div id="investorDropdownList">
              <div class="dropdown-header">Wholesale Partners</div>
              <span class="text-muted" style="padding: 0.5rem 1rem; font-size: 0.8rem;">Loading...</span>
            </div>

            <div class="dropdown-divider"></div>
            <button type="button" class="dropdown-item admin-only-item" data-action="manage-investors" style="display:none;">
              <i class="fas fa-cog"></i> Manage Investors
            </button>
          </div>
        </li>

        <!-- Tools -->
        <li class="nav-item">
          <button type="button" class="nav-button">
            <i class="fas fa-tools"></i>
            Tools
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="dropdown-menu">
            <div class="dropdown-header">Calculators</div>
            <button type="button" class="dropdown-item" data-action="open-mortgage-calculator"><i class="fas fa-calculator"></i> Mortgage Calculator</button>
            <button type="button" class="dropdown-item" data-action="open-apr-calculator"><i class="fas fa-percentage"></i> APR Calculator</button>
            <button type="button" class="dropdown-item" data-action="open-dti-calculator"><i class="fas fa-balance-scale"></i> DTI Calculator</button>
            <button type="button" class="dropdown-item" data-action="open-affordability"><i class="fas fa-chart-pie"></i> Affordability</button>

            <div class="dropdown-divider"></div>
            <div class="dropdown-header">Resources</div>
            <button type="button" class="dropdown-item" data-action="open-guidelines"><i class="fas fa-book-open"></i> Guidelines</button>
            <button type="button" class="dropdown-item" data-action="open-checklists"><i class="fas fa-tasks"></i> Checklists</button>
            <button type="button" class="dropdown-item" data-action="open-forms-library"><i class="fas fa-file-pdf"></i> Forms Library</button>
          </div>
        </li>

      </ul>
    </nav>
  </header>

  <main class="main-content" id="mainContent" tabindex="-1">

    <!-- News + Quick Links -->
    <section class="section-card animate-in">
      <div class="section-header">
        <h2 class="section-title"><i class="fas fa-newspaper"></i> Daily News & Announcements</h2>
        <div class="section-actions">
          <button type="button" class="btn btn-secondary" data-action="open-add-announcement">
            <i class="fas fa-plus"></i> Add Announcement
          </button>
        </div>
      </div>

      <div class="section-body">
        <div class="news-grid">
          <div class="news-feed" id="newsFeed"></div>

          <div class="quick-links">
            <h4><i class="fas fa-link"></i> Quick Links</h4>
            <div class="quick-links-list">
              <a data-link-key="ratesheet" class="quick-link"><i class="fas fa-chart-bar"></i> Today's Rate Sheet</a>
              <button type="button" class="quick-link" data-action="open-lock-desk"><i class="fas fa-file-alt"></i> Lock Desk</button>
              <button type="button" class="quick-link" data-action="open-support-ticket"><i class="fas fa-headset"></i> Support Ticket</button>
              <button type="button" class="quick-link" data-action="open-notifications"><i class="fas fa-bell"></i> Notifications</button>
              <button type="button" class="quick-link" data-action="open-settings"><i class="fas fa-cog"></i> Settings</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Goals -->
    <section class="section-card animate-in">
      <div class="section-header">
        <h2 class="section-title"><i class="fas fa-trophy"></i> Performance & Goals</h2>
        <div class="section-actions">
          <select class="filter-select goal-period-select" id="goalPeriodSelect">
            <option value="weekly">Weekly</option>
            <option value="monthly" selected>Monthly</option>
            <option value="quarterly">Quarterly</option>
            <option value="yearly">Yearly</option>
          </select>
        </div>
      </div>

      <div class="section-body">
        <div class="goals-grid" id="goalsGrid">
          <div class="goal-card" data-goal="loans-closed">
            <div class="goal-icon"><i class="fas fa-file-signature"></i></div>
            <div class="goal-label">Loans Closed</div>
            <div class="goal-value-container">
              <div class="goal-value" id="loansClosedValue">0</div>
              <button type="button" class="goal-edit-btn" title="Edit goal" data-goal="loans-closed"><i class="fas fa-edit"></i></button>
            </div>
            <div class="goal-target">of <span class="goal-target-value" id="loansClosedTarget">0</span> target</div>
            <div class="goal-slider-container u-hidden">
              <input type="range" class="goal-slider" id="loansClosedSlider" min="0" max="100" value="0" step="1" />
              <div class="slider-value-display"><span class="slider-value">0</span></div>
            </div>
            <div class="progress-bar"><div class="progress-fill on-track" id="loansClosedProgress" data-progress="0"></div></div>
            <div class="goal-progress-text" id="loansClosedProgressText">0% complete</div>
          </div>

          <div class="goal-card" data-goal="pull-through">
            <div class="goal-icon"><i class="fas fa-percentage"></i></div>
            <div class="goal-label">Pull-Through</div>
            <div class="goal-value-container">
              <div class="goal-value" id="pullThroughValue">0%</div>
              <button type="button" class="goal-edit-btn" title="Edit goal" data-goal="pull-through"><i class="fas fa-edit"></i></button>
            </div>
            <div class="goal-target">of <span class="goal-target-value" id="pullThroughTarget">0</span>% target</div>
            <div class="goal-slider-container u-hidden">
              <input type="range" class="goal-slider" id="pullThroughSlider" min="0" max="100" value="0" step="1" />
              <div class="slider-value-display"><span class="slider-value">0</span>%</div>
            </div>
            <div class="progress-bar"><div class="progress-fill on-track" id="pullThroughProgress" data-progress="0"></div></div>
            <div class="goal-progress-text" id="pullThroughProgressText">0% complete</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Pipeline (Monday.com Sync) -->
    <section class="section-card animate-in" id="pipelineSection">
      <div class="section-header">
        <h2 class="section-title"><i class="fas fa-chart-line"></i> Loan Pipeline</h2>
        <div class="section-actions">
          <input type="text" id="pipelineSearch" class="search-input" placeholder="Search pipeline..." />
          <select class="filter-select" id="pipelineLO">
            <option value="">All Loan Officers</option>
          </select>
          <button type="button" class="btn btn-secondary btn-sm" id="mondaySyncBtn" data-action="monday-sync" title="Sync from Monday.com">
            <i class="fas fa-sync-alt"></i> Sync
          </button>
          <button type="button" class="btn btn-secondary btn-sm" data-action="monday-settings" title="Monday.com Settings">
            <i class="fas fa-cog"></i>
          </button>
        </div>
      </div>

      <div class="section-body">
        <div class="sync-status-bar" id="syncStatusBar" style="display:none;">
          <i class="fas fa-info-circle"></i>
          <span id="syncStatusText">Last synced: Never</span>
        </div>

        <div class="table-responsive">
          <table class="data-table" id="pipelineTable">
            <thead id="pipelineHead">
              <tr><th colspan="12"><i class="fas fa-spinner fa-spin"></i> Loading pipeline...</th></tr>
            </thead>
            <tbody id="pipelineBody">
              <tr><td class="empty-state">
                <i class="fas fa-database"></i>
                <p>No pipeline data yet. Sync from Monday.com to populate.</p>
              </td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Chat -->
    <section class="section-card animate-in" id="chatSection">
      <div class="section-header">
        <h2 class="section-title"><i class="fas fa-comments"></i> Team Chat</h2>
        <div class="section-actions">
          <button type="button" class="btn btn-sm btn-outline" id="chatManageTagsBtn" title="Manage Tags">
            <i class="fas fa-tags"></i> Manage Tags
          </button>
        </div>
      </div>
      <div class="section-body">
        <div class="chat-container">
          <!-- Tag filter bar -->
          <div class="chat-tag-filter-bar" id="chatTagFilter"></div>

          <!-- Messages -->
          <div class="chat-messages" id="chatMessages" aria-live="polite"></div>

          <!-- Tag picker for outgoing messages -->
          <div class="chat-tag-picker-bar">
            <span class="chat-tag-picker-label"><i class="fas fa-tags"></i> Attach tags:</span>
            <div class="chat-tag-picker" id="chatTagPicker"></div>
          </div>

          <!-- Input -->
          <form class="chat-input-row" id="chatForm">
            <input type="text" id="chatInput" class="chat-input" placeholder="Type a message..." maxlength="1000" autocomplete="off" />
            <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Send</button>
          </form>
        </div>
      </div>
    </section>

    <!-- =========================
         MODALS
    ========================== -->

    <!-- Investor Modal (required by investors.js) -->
    <div id="investorModal" class="investor-modal" aria-hidden="true">
      <div class="modal-content">
        <button type="button" class="modal-close" aria-label="Close modal"><i class="fas fa-times"></i></button>

        <div class="modal-header">
          <div class="investor-header-content">
            <img class="investor-logo" alt="Investor Logo" />
            <h2 class="investor-name">Investor</h2>
          </div>

          <button type="button" class="investor-settings-btn" aria-label="Investor settings">
            <i class="fas fa-gear"></i>
          </button>
        </div>

        <div class="modal-body">
          <div class="investor-info-grid">
            <div class="info-section account-executive" data-section="accountExecutive"></div>
            <div class="info-section investor-details" data-section="details"></div>
            <div class="info-section investor-team" data-section="team"></div>
            <div class="info-section lender-ids" data-section="lenderIds"></div>
            <div class="info-section mortgagee-clause" data-section="mortgageeClause"></div>
            <div class="info-section investor-links" data-section="links"></div>

            <div class="info-section investor-notes u-grid-span-all" data-section="notes">
              <h4><i class="fas fa-note-sticky"></i> Notes</h4>
              <div class="notes-content empty" contenteditable="true"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Company Contacts Modal (required by investors.js open-company-contacts) -->
    <div id="companyContactsModal" class="investor-modal" aria-hidden="true">
      <div class="modal-content">
        <button type="button" class="modal-close contacts-modal-close" aria-label="Close modal"><i class="fas fa-times"></i></button>

        <div class="modal-header">
          <div class="investor-header-content">
            <h2 class="investor-name">Company Contacts</h2>
          </div>
        </div>

        <div class="modal-body">
          <div class="investor-info-grid">
            <div class="info-section u-grid-span-all">
              <h4><i class="fas fa-address-book"></i> Contacts</h4>
              <p class="tbd">Add your contacts list here (or wire to API).</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Support Ticket Modal -->
    <div id="supportTicketModal" class="investor-modal" aria-hidden="true">
      <div class="modal-content">
        <button type="button" class="modal-close support-modal-close" aria-label="Close modal"><i class="fas fa-times"></i></button>
        <div class="modal-header">
          <div class="investor-header-content">
            <h2 class="investor-name">Support Contact</h2>
          </div>
        </div>
        <div class="modal-body">
          <div class="investor-info-grid">
            <div class="info-section u-grid-span-all">
              <h4><i class="fas fa-user-circle"></i> Contact Information</h4>
              <div class="contact-info">
                <div><strong>Zachary Zink</strong></div>
                <div><i class="fas fa-envelope"></i> <a href="mailto:zachary.zink@msfg.us">zachary.zink@msfg.us</a></div>
                <div><i class="fas fa-phone"></i> <a href="tel:3038706518">(303) 870-6518</a></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notificationsModal" class="investor-modal" aria-hidden="true">
      <div class="modal-content">
        <button type="button" class="modal-close notifications-modal-close" aria-label="Close modal"><i class="fas fa-times"></i></button>
        <div class="modal-header">
          <div class="investor-header-content">
            <h2 class="investor-name">Notifications</h2>
          </div>
        </div>
        <div class="modal-body">
          <form id="notificationForm" class="form">
            <div class="form-row">
              <label for="notificationDate">Date</label>
              <input type="date" id="notificationDate" required />
            </div>
            <div class="form-row">
              <label for="notificationTime">Time</label>
              <input type="time" id="notificationTime" required />
            </div>
            <div class="form-row">
              <label for="notificationNote">Note</label>
              <textarea id="notificationNote" rows="3" maxlength="1000" required></textarea>
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary notifications-modal-close">Cancel</button>
              <button type="submit" class="btn btn-primary">Save Reminder</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Monday.com Settings Modal -->
    <div id="mondaySettingsModal" class="investor-modal" aria-hidden="true">
      <div class="modal-content" style="max-width: 720px;">
        <button type="button" class="modal-close monday-modal-close" aria-label="Close modal"><i class="fas fa-times"></i></button>
        <div class="modal-header">
          <div class="investor-header-content">
            <h2 class="investor-name"><i class="fas fa-columns"></i> Monday.com Integration</h2>
          </div>
        </div>
        <div class="modal-body">
          <!-- API Token Status -->
          <div class="info-section" style="margin-bottom: 1.5rem;">
            <h4><i class="fas fa-key"></i> API Token</h4>
            <p id="mondayTokenStatus" class="tbd">Checking...</p>
            <div style="margin-top: 0.5rem;">
              <input type="password" id="mondayTokenInput" placeholder="Paste your Monday.com API token" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 6px; font-size: 0.875rem;" />
              <div style="margin-top: 0.5rem; display: flex; gap: 0.5rem;">
                <button type="button" class="btn btn-primary btn-sm" id="mondaySaveTokenBtn">Save Token</button>
                <button type="button" class="btn btn-secondary btn-sm" id="mondayTestTokenBtn">Test Connection</button>
              </div>
            </div>
          </div>

          <!-- Column Mappings -->
          <div class="info-section" style="margin-bottom: 1.5rem;">
            <h4><i class="fas fa-arrows-alt-h"></i> Column Mappings</h4>
            <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.75rem;">
              Select a board and map its columns to pipeline fields.
            </p>
            <div style="display: flex; gap: 0.5rem; align-items: center; margin-bottom: 0.75rem;">
              <select id="mondayBoardSelect" class="filter-select" style="padding: 0.4rem; font-size: 0.85rem;">
                <option value="">Select a board...</option>
              </select>
              <button type="button" class="btn btn-secondary btn-sm" id="mondayLoadColumnsBtn">
                <i class="fas fa-download"></i> Load Columns
              </button>
            </div>
            <div id="mondayMappingsContainer" style="margin-top: 1rem;"></div>
            <button type="button" class="btn btn-primary btn-sm" id="mondaySaveMappingsBtn" style="display:none; margin-top: 0.75rem;">
              <i class="fas fa-save"></i> Save Mappings
            </button>
          </div>

          <!-- Table Display Config -->
          <div class="info-section" style="margin-bottom: 1.5rem;">
            <h4><i class="fas fa-table-columns"></i> Table Columns</h4>
            <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.75rem;">
              Choose which columns appear in the pipeline table, set custom labels, and reorder them.
              Changes apply after saving.
            </p>
            <div id="mondayDisplayConfig" style="margin-top: 0.5rem;">
              <p style="font-size: 0.8rem; color: var(--text-muted);">Save column mappings first, then configure display here.</p>
            </div>
            <button type="button" class="btn btn-primary btn-sm" id="mondaySaveDisplayBtn" style="display:none; margin-top: 0.75rem;">
              <i class="fas fa-save"></i> Save Display Settings
            </button>
          </div>

          <!-- Sync Controls -->
          <div class="info-section" style="margin-bottom: 1.5rem;">
            <h4><i class="fas fa-sync-alt"></i> Sync</h4>
            <div id="mondaySyncInfo" style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.75rem;">
              No syncs have been run yet.
            </div>
            <button type="button" class="btn btn-primary btn-sm" id="mondayRunSyncBtn">
              <i class="fas fa-play"></i> Run Sync Now
            </button>
          </div>

          <!-- Sync History -->
          <div class="info-section">
            <h4><i class="fas fa-history"></i> Sync History</h4>
            <div id="mondaySyncHistory" style="font-size: 0.85rem; color: var(--text-muted);">
              Loading...
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Announcement Modal -->
    <div id="addAnnouncementModal" class="investor-modal" aria-hidden="true">
      <div class="modal-content">
        <button type="button" class="modal-close announcement-modal-close" aria-label="Close modal"><i class="fas fa-times"></i></button>
        <div class="modal-header">
          <div class="investor-header-content">
            <h2 class="investor-name">Add Announcement</h2>
          </div>
        </div>
        <div class="modal-body">
          <form id="announcementForm" class="form">
            <div class="form-row">
              <label for="announcementTitle">Title</label>
              <input type="text" id="announcementTitle" maxlength="120" required />
            </div>
            <div class="form-row">
              <label for="announcementContent">Content</label>
              <textarea id="announcementContent" rows="4" maxlength="2000" required></textarea>
            </div>
            <div class="form-row">
              <label for="announcementLink">Optional Link</label>
              <input type="url" id="announcementLink" placeholder="https://..." />
            </div>
            <div class="form-row">
              <label for="announcementIcon">Icon</label>
              <select id="announcementIcon">
                <option value="fa-bullhorn" selected>Announcement</option>
                <option value="fa-star">Star</option>
                <option value="fa-triangle-exclamation">Alert</option>
                <option value="fa-circle-info">Info</option>
                <option value="fa-graduation-cap">Training</option>
                <option value="fa-handshake">Partner</option>
              </select>
            </div>
            <div class="form-row">
              <label for="announcementFile">Optional File</label>
              <div class="file-input-wrapper">
                <input type="file" id="announcementFile" />
                <span class="file-input-label">Choose file or drag and drop</span>
              </div>
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary announcement-modal-close">Cancel</button>
              <button type="submit" class="btn btn-primary">Publish</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Manage Investors Modal (admin only) -->
    <div id="manageInvestorsModal" class="investor-modal" aria-hidden="true">
      <div class="modal-content" style="max-width: 1100px;">
        <button type="button" class="modal-close manage-investors-close" aria-label="Close modal"><i class="fas fa-times"></i></button>

        <div class="modal-header">
          <div class="investor-header-content">
            <h2 class="investor-name"><i class="fas fa-handshake"></i> Manage Investors</h2>
          </div>
        </div>

        <div class="modal-body">
          <!-- LIST VIEW -->
          <div id="manageInvestorsList">
            <div class="manage-investors-toolbar">
              <input type="text" id="manageInvestorSearch" class="form-input" placeholder="Search investors..." />
              <span id="manageInvestorCount" class="manage-investor-count"></span>
              <button type="button" class="btn btn-primary" id="manageAddInvestorBtn">
                <i class="fas fa-plus"></i> Add Investor
              </button>
            </div>

            <div class="table-responsive">
              <table class="data-table manage-investors-table">
                <thead>
                  <tr>
                    <th>Investor</th>
                    <th>Account Exec</th>
                    <th>AE Email</th>
                    <th>AE Phone</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="manageInvestorsTableBody"></tbody>
              </table>
            </div>
          </div>

          <!-- FORM VIEW (add / edit) -->
          <div id="manageInvestorForm" style="display:none;">
            <h3 id="manageFormTitle" class="manage-form-title">Add Investor</h3>
            <form id="investorAdminForm" class="manage-investor-form">
              <div class="form-grid">
                <div class="form-group">
                  <label for="inv_name"><i class="fas fa-building"></i> Investor Name *</label>
                  <input type="text" id="inv_name" class="form-input" required />
                </div>
                <div class="form-group">
                  <label for="inv_ae_name"><i class="fas fa-user-tie"></i> Account Exec</label>
                  <input type="text" id="inv_ae_name" class="form-input" />
                </div>
                <div class="form-group">
                  <label for="inv_ae_email"><i class="fas fa-envelope"></i> AE Email</label>
                  <input type="email" id="inv_ae_email" class="form-input" />
                </div>
                <div class="form-group">
                  <label for="inv_ae_phone"><i class="fas fa-phone"></i> AE Phone</label>
                  <input type="tel" id="inv_ae_phone" class="form-input" />
                </div>
                <div class="form-group">
                  <label for="inv_states"><i class="fas fa-map-marked-alt"></i> States</label>
                  <input type="text" id="inv_states" class="form-input" placeholder="e.g. CO, TX, CA" />
                </div>
                <div class="form-group">
                  <label for="inv_bestPrograms"><i class="fas fa-star"></i> Best Programs</label>
                  <input type="text" id="inv_bestPrograms" class="form-input" />
                </div>
                <div class="form-group">
                  <label for="inv_minimumFico"><i class="fas fa-chart-bar"></i> Minimum FICO</label>
                  <input type="text" id="inv_minimumFico" class="form-input" />
                </div>
                <div class="form-group">
                  <label for="inv_inHouseDpa"><i class="fas fa-hand-holding-usd"></i> In-house DPA</label>
                  <input type="text" id="inv_inHouseDpa" class="form-input" />
                </div>
                <div class="form-group">
                  <label for="inv_epo"><i class="fas fa-clock"></i> EPO</label>
                  <input type="text" id="inv_epo" class="form-input" />
                </div>
                <div class="form-group">
                  <label for="inv_maxComp"><i class="fas fa-dollar-sign"></i> Max Comp</label>
                  <input type="number" id="inv_maxComp" class="form-input" step="0.01" />
                </div>
                <div class="form-group">
                  <label for="inv_docReviewForWireRelease"><i class="fas fa-file-invoice"></i> Doc Review for Wire Release</label>
                  <input type="text" id="inv_docReviewForWireRelease" class="form-input" />
                </div>
                <div class="form-group">
                  <label for="inv_remoteClosingReview"><i class="fas fa-laptop-house"></i> Remote Closing Review</label>
                  <input type="text" id="inv_remoteClosingReview" class="form-input" />
                </div>
                <div class="form-group">
                  <label for="inv_websiteUrl"><i class="fas fa-globe"></i> Link to Website</label>
                  <input type="url" id="inv_websiteUrl" class="form-input" placeholder="https://..." />
                </div>
                <div class="form-group form-group-full">
                  <label for="inv_notes"><i class="fas fa-note-sticky"></i> Notes</label>
                  <textarea id="inv_notes" class="form-input" rows="3"></textarea>
                </div>
              </div>

              <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="manageFormCancelBtn">Cancel</button>
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Investor</button>
              </div>
            </form>
          </div>
        </div>

      </div>
    </div>

    <!-- Manage Tags Modal -->
    <div id="manageTagsModal" class="investor-modal" aria-hidden="true">
      <div class="modal-content" style="max-width: 520px;">
        <div class="modal-header">
          <h3 class="modal-title"><i class="fas fa-tags"></i> Manage Tags</h3>
          <button type="button" class="modal-close" id="closeManageTagsModal" aria-label="Close modal">&times;</button>
        </div>
        <div class="modal-body" style="padding: var(--spacing-md);">
          <!-- Create new tag -->
          <div class="manage-tags-create">
            <div class="manage-tags-create-row">
              <input type="text" id="newTagNameInput" class="form-input" placeholder="New tag name..." maxlength="100" />
              <input type="color" id="newTagColorInput" class="form-input manage-tags-color-input" value="#8cc63e" title="Pick a color" />
              <button type="button" class="btn btn-primary btn-sm" id="createTagSaveBtn"><i class="fas fa-plus"></i> Add</button>
            </div>
          </div>

          <!-- Existing tags list -->
          <div class="manage-tags-list" id="manageTagsList">
            <p class="text-muted" style="text-align:center; padding: 2rem 0;">Loading tags...</p>
          </div>
        </div>
      </div>
    </div>

  </main>

  <footer class="footer">
    <p>
      Â© 2024 Mountain State Financial Group. All rights reserved. |
      <button type="button" class="link-item" data-action="open-privacy">Privacy Policy</button> |
      <button type="button" class="link-item" data-action="open-terms">Terms of Service</button> |
      <button type="button" class="link-item" data-action="open-support">Support</button>
    </p>
  </footer>

  <!-- Scripts (load order matters) -->
  <script src="js/config.js?v=20260211-1"></script>
  <script src="js/link-init.js?v=20260211-1"></script>
  <script src="js/action-dispatcher.js?v=20260211-1"></script>

  <script src="js/api-server.js?v=20260211-1"></script>
  <script src="js/utils.js?v=20260211-1"></script>
  <script src="js/theme.js?v=20260211-1"></script>
  <script src="js/tables.js?v=20260211-1"></script>
  <script src="js/chat.js?v=20260211-1"></script>
  <script src="js/api.js?v=20260211-1"></script>
  <script src="js/investors.js?v=20260211-1"></script>
  <script src="js/goals.js?v=20260211-1"></script>
  <script src="js/modals.js?v=20260211-1"></script>

  <!-- Accessibility -->
  <script src="js/a11y.js?v=20260211-1"></script>

  <!-- CSP-friendly progress widths -->
  <script src="js/progress-init.js?v=20260211-1"></script>

  <script src="js/app.js?v=20260211-1"></script>
</body>
</html>